# 스마트 바구니 시스템: MQTT 토픽 네이밍 및 바구니 ID 설계 가이드

## 1. 바구니 고유 식별 및 토픽 네이밍

- 각 스마트 바구니(라즈베리파이 1대)는 **고유 ID**를 가짐  
- 각 바구니는 **자신만의 MQTT 토픽**으로 서버에 메시지 전송
    - 예시: `basket/unit0001`, `basket/unit0002`, ...

### 토픽 네이밍 규칙

- **prefix**는 `basket/` (또는 환경에 따라 확장: `basket/store01/`)
- **unit ID**는 숫자 네이밍(0001, 0002, ...) 또는 바코드/QR코드와 매핑된 값
- **슬래시(`/`)**로 구분, **한글/띄어쓰기/특수문자** 금지  
- 예시: `basket/1` 또는 `basket/unit0123` (O), `basket/001 23` (X)
- 필요시, 매장/구역 정보도 추가 가능  
    - 예: `basket/store02/unit015`

---

## 2. 바구니 최대 수량 설계

- 일반 대형마트 기준: **100~500개** 바구니 보유
- 초대형 점포/창고형 매장: **500~800개** 이상도 가능
- **세자리수(001~999)**면 대부분 매장에 충분  
    - 네 자리(0001~9999)는 전국망, 대형 확장도 커버

---

## 3. MQTT Pub/Sub Best Practice

- **컨트롤러 명령 수신**: `${MQTT_TOPIC}/status` (예: `basket/1/status`)
- **장바구니 업데이트 발행**: `${MQTT_TOPIC}/update` (예: `basket/1/update`)
- **서버(Spring 등)에서는 `basket/#`로 전체 메시지 subscribe**
- 바구니 분실/고장/교체시에도 고유ID 관리가 용이
- 데이터 관리, 트래픽 분산, 실시간 모니터링 등 다양한 확장에 유리

---

## 4. 실무 운영 시 참고사항

- 바구니 고유ID는 **QR/바코드**와 연계 가능 (배포/회수 관리)
- **토픽 네이밍 규칙** 문서화 및 팀 내 공유 권장
- 토픽 네임/ID는 DB의 basket 테이블 등과 1:1로 매핑 추천
- **토픽 네이밍은 확장성(매장/지역/구역 등) 고려 설계**
    - 예: `basket/{store_id}/unit{basket_id}`

---

## 5. 예시

| 바구니번호 | 기본 토픽 (MQTT_TOPIC) | 명령 토픽 (status)   | 발행 토픽 (update)   |
|:----------:|:----------------------|:----------------------|:----------------------|
|      1     | basket/1              | basket/1/status       | basket/1/update       |
|    123     | basket/123            | basket/123/status     | basket/123/update     |
|   매장2-15 | basket/store02/unit015| basket/store02/unit015/status | basket/store02/unit015/update |

---

## 6. 결론

- **고유ID 기반 토픽 네이밍**은 관리와 확장에 유리하고,
- 컨트롤러는 `${MQTT_TOPIC}/status` 명령을 수신하고 `${MQTT_TOPIC}/update`로 발행합니다.
- 예제 스크립트는 `examples/` 아래에서 실행할 수 있습니다.

---
